services:
  jarvis-agent:
    image: nginx:alpine
    container_name: jarvis-agent
    restart: unless-stopped

    volumes:
      # simple static site content (you can drop an index.html in here later)
      - /opt/jarvis/data:/usr/share/nginx/html:ro

    networks:
      - jarvis_net

    # internal port only; NPM will forward to this
    expose:
      - "80"
##
##
  jarvis-brain:
    build: ./brain
    container_name: jarvis-brain
    restart: unless-stopped
    networks:
      - jarvis_net
    expose:
      - "8000"       # internal Docker Network
    ports:
      - "8000:8000"  # host:container mapping
    volumes:
      - /opt/jarvis/brain-data:/app/data
    environment:
      # OpenAI-compatible / model-agnostic config
      JARVIS_LLM_API_KEY: ${JARVIS_LLM_API_KEY}
      JARVIS_LLM_BASE_URL: ${JARVIS_LLM_BASE_URL:-https://api.openai.com/v1}
      JARVIS_LLM_MODEL: ${JARVIS_LLM_MODEL:-gpt-4o-mini}
      JARVIS_LLM_PROVIDER: ${JARVIS_LLM_PROVIDER:-openai}

      # Home Assistant
      HOMEASSISTANT_BASE_URL: ${HOMEASSISTANT_BASE_URL}
      HOMEASSISTANT_TOKEN: ${HOMEASSISTANT_TOKEN}

      # Grocy
      GROCY_BASE_URL: ${GROCY_BASE_URL}
      GROCY_API_KEY: ${GROCY_API_KEY}

      # Jarvis API key for frontend/backend auth
      JARVIS_API_KEY: ${JARVIS_API_KEY}

      # BarcodeBuddy
      BARCODEBUDDY_BASE_URL: ${BARCODEBUDDY_BASE_URL}
      BARCODEBUDDY_API_KEY: ${BARCODEBUDDY_API_KEY}

networks:
  jarvis_net:
    external: true
